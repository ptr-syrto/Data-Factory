{
	"name": "Cosmos",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "Company_Financial_Staging",
						"type": "DatasetReference"
					},
					"name": "BalanceSheets"
				},
				{
					"dataset": {
						"referenceName": "Company_Info_Staging",
						"type": "DatasetReference"
					},
					"name": "Anagraphics"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "CompaniesCosmos",
						"type": "DatasetReference"
					},
					"name": "ToCosmos"
				}
			],
			"transformations": [
				{
					"name": "Groupbyid"
				},
				{
					"name": "CreateBSStructs",
					"description": "Creating Struct columns\n"
				},
				{
					"name": "CombineInfo"
				}
			],
			"scriptLines": [
				"source(output(",
				"          old_id as string,",
				"          uuid as string,",
				"          year as string,",
				"          market_type2 as string,",
				"          market_type1 as string,",
				"          has_gaps as string,",
				"          employees as string,",
				"          acc_format as string,",
				"          added_value as string,",
				"          deferred_liq as string,",
				"          cur_passive as string,",
				"          cons_passive as string,",
				"          tot_sources as string,",
				"          op_EBIT as string,",
				"          ROE as string,",
				"          ROA as string,",
				"          sales_assets as string,",
				"          prod_per_empl as string,",
				"          self_coverage as string,",
				"          ICap as string,",
				"          financial_sust as string,",
				"          cap_adequacy as string,",
				"          CBC as string,",
				"          Personnel_Cost_to_Revenue as string,",
				"          Indeb_Ratio as string,",
				"          DSO as string,",
				"          DPO as string,",
				"          DSI as string,",
				"          Non_Curr_Liabilities_Fixed_Asset_Ratio as string,",
				"          Curr_Asset_Total_Asset_Ratio as string,",
				"          Current_Debt_Total_Debt_Ratio as string,",
				"          Cash_Curr_Asset_Ratio as string,",
				"          Market_Value as string,",
				"          Financial_Debt_Net_Worth as string,",
				"          Liquid_Cov_Fin_Debt as string,",
				"          Liquidity as string,",
				"          Revenue as string,",
				"          Costs_Raw_Materials_Services as string,",
				"          {asset-liability_mismatch} as string,",
				"          {FE-01} as string,",
				"          {FE-02} as string,",
				"          {FE-03} as string,",
				"          {FE-04} as string,",
				"          {FE-05} as string,",
				"          {FE-06} as string,",
				"          {FE-07} as string,",
				"          {FE-08} as string,",
				"          {FE-09} as string,",
				"          {FE-11} as string,",
				"          {FE-12} as string,",
				"          {FE-13} as string,",
				"          {FE-14} as string,",
				"          {FE-15} as string,",
				"          {FE-16} as string,",
				"          {FE-18} as string,",
				"          {FE-19} as string,",
				"          {FE-20} as string,",
				"          EBITDA as string,",
				"          cur_active as string,",
				"          CCnLp as string,",
				"          UFCF as string,",
				"          CapEx as string,",
				"          quick_ratio as string,",
				"          global_coverage as string,",
				"          RCT as string,",
				"          Cash_Ratio as string,",
				"          CCC as string,",
				"          Added_Value_Employee as string,",
				"          Industry_Contribution_GDP as string,",
				"          financial_mismatch as string,",
				"          op_EBIT_Margin as string,",
				"          {Revenue_self-financing} as string,",
				"          {CAGR_3-years} as string,",
				"          {FE-17} as string,",
				"          EBIT as string,",
				"          tot_investiments as string,",
				"          CCn as string,",
				"          financial_ebitda as string,",
				"          secondary_liq as string,",
				"          Ebitda_Margin as string,",
				"          {Ebitda_Fin-Interest} as string,",
				"          Debt_ebitda_Ratio as string,",
				"          Capex_Sales_Ratio as string,",
				"          {liquidity-debt_service_cover_ratio} as string,",
				"          interest_coverage_ratio as string,",
				"          EBT as string,",
				"          inv_CAP as string,",
				"          workCap_sales as string,",
				"          op_leverage as string,",
				"          ROTA as string,",
				"          {Ebitda_CAGR_3-years} as string,",
				"          Ebit_Margin as string,",
				"          {FE-10} as string,",
				"          ROI as string,",
				"          ROCE as string,",
				"          UFCF_cap as string,",
				"          opCash_capital as string,",
				"          liq_ret_activity as string,",
				"          net_return_on_invested_capital as string,",
				"          {Zp-scoreltman} as string,",
				"          {Zpp-scoreltman} as string,",
				"          Value_Creation_Index as string,",
				"          revenue_growth as string,",
				"          OverIndebtedness_Ratio as string,",
				"          size as string,",
				"          macro_area as string,",
				"          market_area as string,",
				"          id as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     inferDriftedColumnTypes: true,",
				"     ignoreNoFilesFound: false,",
				"     format: 'parquet') ~> BalanceSheets",
				"source(output(",
				"          id as string,",
				"          name as string,",
				"          TIN as string,",
				"          EVN as string,",
				"          location as string,",
				"          legal as string,",
				"          nace as string,",
				"          last_available_year as string,",
				"          size as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     inferDriftedColumnTypes: true,",
				"     ignoreNoFilesFound: false,",
				"     format: 'parquet') ~> Anagraphics",
				"CreateBSStructs aggregate(groupBy(id),",
				"     financials = collect(Financials)) ~> Groupbyid",
				"BalanceSheets derive(Financials = @(uuid={uuid},",
				"          year={year},",
				"          employees={employees},",
				"          added_value={added_value},",
				"          deferred_liq={deferred_liq},",
				"          cur_passive={cur_passive},",
				"          cons_passive={cons_passive},",
				"          tot_sources={tot_sources},",
				"          op_EBIT={op_EBIT},",
				"          ROE={ROE},",
				"          ROA={ROA},",
				"          sales_assets={sales_assets},",
				"          prod_per_empl={prod_per_empl},",
				"          self_coverage={self_coverage},",
				"          ICap={ICap},",
				"          financial_sust={financial_sust},",
				"          cap_adequacy={cap_adequacy},",
				"          CBC={CBC},",
				"          Personnel_Cost_to_Revenue={Personnel_Cost_to_Revenue},",
				"          Indeb_Ratio={Indeb_Ratio},",
				"          DSO={DSO},",
				"          DPO={DPO},",
				"          DSI={DSI},",
				"          Non_Curr_Liabilities_Fixed_Asset_Ratio={Non_Curr_Liabilities_Fixed_Asset_Ratio},",
				"          Curr_Asset_Total_Asset_Ratio={Curr_Asset_Total_Asset_Ratio},",
				"          Current_Debt_Total_Debt_Ratio={Current_Debt_Total_Debt_Ratio},",
				"          Cash_Curr_Asset_Ratio={Cash_Curr_Asset_Ratio},",
				"          Market_Value={Market_Value},",
				"          Financial_Debt_Net_Worth={Financial_Debt_Net_Worth},",
				"          Liquid_Cov_Fin_Debt={Liquid_Cov_Fin_Debt},",
				"          Liquidity={Liquidity},",
				"          Revenue={Revenue},",
				"          Costs_Raw_Materials_Services={Costs_Raw_Materials_Services},",
				"          {asset-liability_mismatch}={asset-liability_mismatch},",
				"          EBITDA={EBITDA},",
				"          cur_active={cur_active},",
				"          CCnLp={CCnLp},",
				"          UFCF={UFCF},",
				"          CapEx={CapEx},",
				"          quick_ratio={quick_ratio},",
				"          global_coverage={global_coverage},",
				"          RCT={RCT},",
				"          Cash_Ratio={Cash_Ratio},",
				"          CCC={CCC},",
				"          Added_Value_Employee={Added_Value_Employee},",
				"          Industry_Contribution_GDP={Industry_Contribution_GDP},",
				"          financial_mismatch={financial_mismatch},",
				"          op_EBIT_Margin={op_EBIT_Margin},",
				"          {Revenue_self-financing}={Revenue_self-financing},",
				"          {CAGR_3-years}={CAGR_3-years},",
				"          EBIT={EBIT},",
				"          tot_investiments={tot_investiments},",
				"          CCn={CCn},",
				"          financial_ebitda={financial_ebitda},",
				"          secondary_liq={secondary_liq},",
				"          Ebitda_Margin={Ebitda_Margin},",
				"          {Ebitda_Fin-Interest}={Ebitda_Fin-Interest},",
				"          Debt_ebitda_Ratio={Debt_ebitda_Ratio},",
				"          Capex_Sales_Ratio={Capex_Sales_Ratio},",
				"          {liquidity-debt_service_cover_ratio}={liquidity-debt_service_cover_ratio},",
				"          interest_coverage_ratio={interest_coverage_ratio},",
				"          EBT={EBT},",
				"          inv_CAP={inv_CAP},",
				"          workCap_sales={workCap_sales},",
				"          op_leverage={op_leverage},",
				"          ROTA={ROTA},",
				"          {Ebitda_CAGR_3-years}={Ebitda_CAGR_3-years},",
				"          Ebit_Margin={Ebit_Margin},",
				"          ROI={ROI},",
				"          ROCE={ROCE},",
				"          UFCF_cap={UFCF_cap},",
				"          opCash_capital={opCash_capital},",
				"          liq_ret_activity={liq_ret_activity},",
				"          net_return_on_invested_capital={net_return_on_invested_capital},",
				"          {Zp-scoreltman}={Zp-scoreltman},",
				"          {Zpp-scoreltman}={Zpp-scoreltman},",
				"          Value_Creation_Index={Value_Creation_Index},",
				"          revenue_growth={revenue_growth},",
				"          OverIndebtedness_Ratio={OverIndebtedness_Ratio},",
				"          size={size})) ~> CreateBSStructs",
				"Groupbyid, Anagraphics join(Groupbyid@id == Anagraphics@id,",
				"     joinType:'left',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> CombineInfo",
				"CombineInfo sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:true,",
				"     upsertable:true,",
				"     format: 'document',",
				"     partitionKey: ['/id'],",
				"     throughput: 4000,",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     preCommands: [],",
				"     postCommands: []) ~> ToCosmos"
			]
		}
	}
}